{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "CodeGuardian Static Analysis Rule Schema",
    "description": "Schema for defining static analysis vulnerability detection rules",
    "type": "object",
    "required": [
        "rules"
    ],
    "properties": {
        "rules": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/rule"
            }
        }
    },
    "definitions": {
        "rule": {
            "type": "object",
            "required": [
                "id",
                "name",
                "cwe_id",
                "severity",
                "type",
                "description"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique rule identifier",
                    "pattern": "^[a-z0-9_-]+$"
                },
                "name": {
                    "type": "string",
                    "description": "Human-readable rule name"
                },
                "cwe_id": {
                    "type": "string",
                    "description": "CWE identifier (e.g., CWE-89)",
                    "pattern": "^CWE-[0-9]+$"
                },
                "severity": {
                    "type": "string",
                    "enum": [
                        "CRITICAL",
                        "HIGH",
                        "MEDIUM",
                        "LOW",
                        "INFO"
                    ],
                    "description": "Issue severity level"
                },
                "confidence": {
                    "type": "string",
                    "enum": [
                        "HIGH",
                        "MEDIUM",
                        "LOW"
                    ],
                    "description": "Detection confidence level"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "regex",
                        "api_call",
                        "keyword",
                        "ast_pattern",
                        "metric_threshold"
                    ],
                    "description": "Rule detection type"
                },
                "language": {
                    "type": "string",
                    "description": "Applicable programming language(s)",
                    "enum": [
                        "python",
                        "java",
                        "cpp",
                        "c",
                        "javascript",
                        "typescript",
                        "php",
                        "go",
                        "ruby",
                        "csharp",
                        "all"
                    ]
                },
                "pattern": {
                    "type": "string",
                    "description": "Regex pattern for regex type rules"
                },
                "api_names": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "API function/method names for api_call type"
                },
                "keywords": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Keywords to detect for keyword type"
                },
                "ast_pattern": {
                    "type": "object",
                    "description": "AST pattern matching configuration",
                    "properties": {
                        "node_type": {
                            "type": "string"
                        },
                        "conditions": {
                            "type": "object"
                        }
                    }
                },
                "metric_threshold": {
                    "type": "object",
                    "description": "Metric-based threshold detection",
                    "properties": {
                        "metric": {
                            "type": "string"
                        },
                        "operator": {
                            "type": "string",
                            "enum": [
                                ">",
                                ">=",
                                "<",
                                "<=",
                                "==",
                                "!="
                            ]
                        },
                        "value": {
                            "type": "number"
                        }
                    }
                },
                "description": {
                    "type": "string",
                    "description": "Detailed description of the vulnerability"
                },
                "remediation": {
                    "type": "string",
                    "description": "How to fix the vulnerability"
                },
                "examples": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "vulnerable": {
                                "type": "string",
                                "description": "Vulnerable code example"
                            },
                            "safe": {
                                "type": "string",
                                "description": "Safe code example"
                            }
                        }
                    },
                    "description": "Code examples showing vulnerable and safe patterns"
                },
                "references": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "External references (URLs, papers, etc.)"
                },
                "owasp": {
                    "type": "string",
                    "description": "OWASP category mapping"
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Additional tags for categorization"
                }
            }
        }
    }
}